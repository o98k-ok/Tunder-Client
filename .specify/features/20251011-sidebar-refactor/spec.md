# 左侧请求列表 UI 重构 - 功能规格

## 元数据
- **Feature ID**: sidebar-refactor
- **Created**: 2025-10-11
- **Status**: Draft
- **Priority**: Medium
- **Estimated Effort**: 3-4 hours

---

## 1. 概述

### 1.1 功能描述
重构左侧请求列表的视觉呈现，使其与参考设计图保持一致，采用彩色方法标签（GET/POST/PUT/DELETE）替代当前的圆点图标，同时保持所有现有功能不受影响。

### 1.2 业务价值
- **视觉一致性**: 与现代 API 工具（Postman、Insomnia）的设计语言保持一致
- **信息密度**: 方法标签比圆点图标提供更直观的信息
- **用户体验**: 更清晰的视觉层级和更易识别的请求类型
- **品牌形象**: 提升产品的专业度和现代感

### 1.3 当前实现分析

**现状**:
- 使用 `vscode.ThemeIcon('circle-filled')` 显示彩色圆点
- 方法名称显示在 `description` 字段（右侧灰色文本）
- 文件夹使用彩色文件夹图标
- 基于 VSCode TreeView API 实现

**问题**:
1. 圆点图标信息密度低，需要查看 description 才知道方法类型
2. 视觉风格与参考设计不一致
3. 方法标签不够醒目，用户需要额外注意力识别

### 1.4 参考设计分析

基于用户提供的图片，目标设计具有以下特征：
- **GET**: 绿色背景圆角标签，白色文字
- **POST**: 蓝色背景圆角标签，白色文字  
- **PUT**: 橙色背景圆角标签，白色文字
- **DELETE**: 红色背景（推断）
- **PATCH**: 黄色背景（推断）
- 标签位于请求名称左侧
- 标签尺寸紧凑，圆角设计

---

## 2. 功能需求

### FR1: 方法标签视觉设计
- **FR1.1**: 每个请求显示方法类型标签（GET/POST/PUT/DELETE/PATCH/HEAD/OPTIONS）
- **FR1.2**: 标签采用圆角矩形背景，内含白色大写方法名
- **FR1.3**: 标签颜色映射：
  - GET: 绿色 (#73BF69 或 VSCode 主题绿色)
  - POST: 蓝色 (#4A90E2 或 VSCode 主题蓝色)
  - PUT: 橙色 (#E8A434 或 VSCode 主题橙色)
  - DELETE: 红色 (#F44747 或 VSCode 主题红色)
  - PATCH: 黄色 (#FFCC00 或 VSCode 主题黄色)
  - HEAD: 紫色 (#C586C0 或 VSCode 主题紫色)
  - OPTIONS: 灰色 (#858585 或 VSCode 主题灰色)

### FR2: 布局与间距
- **FR2.1**: 标签位于请求名称左侧，保持适当间距
- **FR2.2**: 标签尺寸紧凑，不占用过多空间
- **FR2.3**: 文件夹图标保持不变
- **FR2.4**: 整体列表布局保持清晰的视觉层级

### FR3: 功能保持
- **FR3.1**: 点击请求仍触发 `httpClient.loadRequest` 命令
- **FR3.2**: 右键菜单功能不变
- **FR3.3**: 文件夹展开/折叠功能不变
- **FR3.4**: 请求排序逻辑不变
- **FR3.5**: 与自动保存功能兼容

### FR4: 主题适配
- **FR4.1**: 标签颜色在深色/浅色主题下都清晰可见
- **FR4.2**: 使用 VSCode 主题颜色变量确保一致性
- **FR4.3**: 标签文字颜色始终为白色或高对比度颜色

---

## 3. 非功能需求

### NFR1: 性能要求
- 列表渲染性能不受影响
- 大量请求（100+）时无明显卡顿
- 标签渲染不增加显著内存占用

### NFR2: 可维护性
- 颜色映射逻辑集中管理，易于扩展新方法
- 代码结构清晰，便于后续调整样式

### NFR3: 兼容性
- 兼容 VSCode 1.60.0+
- 兼容深色和浅色主题
- 不破坏现有的 TreeView 功能

---

## 4. 验收标准

### AC1: 视觉呈现
- ✅ 所有请求显示彩色方法标签
- ✅ 标签颜色与参考设计一致
- ✅ 标签圆角、尺寸、间距符合设计
- ✅ 深色/浅色主题下都清晰可见

### AC2: 功能完整性
- ✅ 点击请求正常加载
- ✅ 右键菜单功能正常
- ✅ 文件夹展开/折叠正常
- ✅ 请求排序正常
- ✅ 与自动保存功能无冲突

### AC3: 性能表现
- ✅ 100+ 请求时列表流畅
- ✅ 无明显渲染延迟
- ✅ 内存占用无异常增长

### AC4: 边界情况
- ✅ 未知方法类型显示默认样式
- ✅ 空文件夹显示正常
- ✅ 长请求名称不影响标签显示

---

## 5. 技术约束

### TC1: VSCode TreeView API 限制
- **约束**: VSCode TreeView 不支持自定义 HTML 渲染
- **影响**: 需要使用 TreeItem 的 `label`、`description`、`iconPath` 等属性组合实现
- **方案**: 使用自定义图标（SVG）或 ThemeIcon 组合

### TC2: 标签实现方式
- **选项 A**: 使用 `label` 字段拼接方法标签和请求名称
- **选项 B**: 使用自定义 SVG 图标作为 `iconPath`
- **选项 C**: 使用 `resourceUri` + 文件装饰器（Decorations API）
- **推荐**: 选项 A（最简单，兼容性最好）

### TC3: 颜色管理
- **约束**: 需要适配 VSCode 主题系统
- **影响**: 不能使用硬编码颜色
- **方案**: 使用 `vscode.ThemeColor` 或在 `label` 中使用 ANSI 颜色码（如支持）

---

## 6. 成功指标

1. **视觉一致性**: 用户反馈"与参考设计一致"或"更好"
2. **识别效率**: 用户识别请求方法的时间减少 50%
3. **功能稳定性**: 重构后无功能回归 bug
4. **性能影响**: 列表渲染时间增加 < 10%

---

## 7. 假设与依赖

### 假设
1. VSCode TreeView API 支持足够的自定义能力实现设计
2. 用户期望与 Postman/Insomnia 类似的视觉风格
3. 方法标签比圆点图标更直观

### 依赖
1. 依赖 VSCode TreeView API
2. 依赖现有的 `DirectoryTreeProvider` 实现
3. 依赖 VSCode 主题系统

---

## 8. 范围外

以下功能不在本次重构范围内：

1. ❌ 修改文件夹图标样式
2. ❌ 添加请求搜索/过滤功能
3. ❌ 修改右键菜单内容
4. ❌ 添加请求拖拽排序功能
5. ❌ 修改请求数据模型

---

## 9. 风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| VSCode API 限制无法实现设计 | 需要妥协设计 | 中 | 提前验证 API 能力；准备备选方案 |
| 标签在某些主题下不清晰 | 用户体验下降 | 低 | 使用高对比度颜色；添加边框 |
| 性能回归 | 用户体验下降 | 低 | 性能测试；优化渲染逻辑 |
| 与现有功能冲突 | 功能异常 | 低 | 详细测试；保持 API 不变 |

---

## 10. 附录

### A. 相关代码位置
- `src/views/DirectoryTreeProvider.ts` - TreeView 提供者实现
- `RequestTreeItem` 类 - 请求树项实现

### B. 参考资料
- [VSCode TreeView API](https://code.visualstudio.com/api/extension-guides/tree-view)
- [VSCode ThemeColor](https://code.visualstudio.com/api/references/theme-color)
- [VSCode TreeItem](https://code.visualstudio.com/api/references/vscode-api#TreeItem)

### C. 设计决策记录

**Q1: 为什么选择标签而非图标？**  
A: 标签提供更直观的信息，用户无需记忆颜色与方法的映射关系，符合现代 API 工具的设计趋势。

**Q2: 为什么保持文件夹图标不变？**  
A: 文件夹图标已经清晰明了，无需修改。重构聚焦于请求列表的视觉改进。

**Q3: 如何处理 VSCode API 限制？**  
A: 优先使用 `label` 字段拼接实现，如果效果不佳，考虑使用自定义 SVG 图标或文件装饰器 API。

